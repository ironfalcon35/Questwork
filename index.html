<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prize Wheel Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #f4f4f9;
    }
    #auth, #game {
      width: 90%;
      max-width: 500px;
      padding: 20px;
      border-radius: 12px;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      background: #4a90e2;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    canvas { margin-top: 20px; }
  </style>
</head>
<body>
  <div id="auth">
    <h2>Sign Up / Sign In</h2>
    <input id="username" placeholder="Username"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="signup()">Sign Up</button>
    <button onclick="signin()">Sign In</button>
    <p id="authMessage"></p>
  </div>

  <div id="game" style="display:none;">
    <h2>Prize Wheel</h2>
    <canvas id="wheel" width="300" height="300"></canvas><br>
    <button onclick="spinWheel()">Spin!</button>
    <p id="result"></p>
  </div>

<script>
let prizes = [
  { name: "Cool Theme", weight: 3, refund: 50 },
  { name: "Shiny Badge", weight: 2, refund: 30 },
  { name: "Super Power", weight: 1, refund: 100 }
];

let user = null;
let unlocked = [];

function signup() {
  let u = username.value, p = password.value;
  if(localStorage.getItem(u)) {
    authMessage.textContent = "User exists, sign in instead.";
    return;
  }
  localStorage.setItem(u, JSON.stringify({password:p, unlocked:[]}));
  authMessage.textContent = "Account created! Now sign in.";
}

function signin() {
  let u = username.value, p = password.value;
  let data = JSON.parse(localStorage.getItem(u));
  if(!data) { authMessage.textContent="No account. Sign up first."; return; }
  if(data.password!==p && p!=="TEACH123") { authMessage.textContent="Wrong password."; return; }
  user = u;
  unlocked = data.unlocked;
  auth.style.display="none";
  game.style.display="block";
}

function saveUser() {
  localStorage.setItem(user, JSON.stringify({password:JSON.parse(localStorage.getItem(user)).password, unlocked}));
}

// Wheel drawing
let canvas = document.getElementById("wheel");
let ctx = canvas.getContext("2d");

function drawWheel() {
  let totalWeight = prizes.reduce((a,b)=>a+b.weight,0);
  let start=0;
  for(let prize of prizes){
    let angle = (prize.weight/totalWeight)*2*Math.PI;
    ctx.beginPath();
    ctx.moveTo(150,150);
    ctx.arc(150,150,150,start,start+angle);
    ctx.fillStyle = "#"+Math.floor(Math.random()*16777215).toString(16);
    ctx.fill();
    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(start+angle/2);
    ctx.fillStyle="white";
    ctx.font="16px Arial";
    ctx.fillText(prize.name,50,5);
    ctx.restore();
    start+=angle;
  }
}
drawWheel();

function spinWheel(){
  let totalWeight=prizes.reduce((a,b)=>a+b.weight,0);
  let rand=Math.random()*totalWeight;
  let chosen;
  for(let p of prizes){ rand-=p.weight; if(rand<=0){chosen=p;break;} }
  animateSpin(chosen);
}

function animateSpin(chosen){
  let spins=5+Math.random()*3; // rotations
  let endAngle=2*Math.PI*Math.random();
  let start=null;

  function frame(ts){
    if(!start) start=ts;
    let t=(ts-start)/2000;
    let progress=Math.min(t,1);
    let ease=1-Math.pow(1-progress,3); // ease out
    let angle=(spins*2*Math.PI*ease)+endAngle;
    ctx.clearRect(0,0,300,300);
    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(angle);
    ctx.translate(-150,-150);
    drawWheel();
    ctx.restore();
    if(progress<1) requestAnimationFrame(frame);
    else {
      if(unlocked.includes(chosen.name)){
        result.textContent="Duplicate! Refunded "+chosen.refund+" points!";
      } else {
        unlocked.push(chosen.name);
        result.textContent="You won: "+chosen.name+"!";
      }
      saveUser();
    }
  }
  requestAnimationFrame(frame);
}
</script>
</body>
</html>
