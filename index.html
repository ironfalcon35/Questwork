<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Questwork 4.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin:0;
    font-family:'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#1f1c2c 0%,#928DAB 100%);
    color:#fff;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    text-align:center;
    transition:background 0.5s ease;
  }
  .card {
    background: rgba(0,0,0,0.6);
    padding:20px;
    border-radius:16px;
    box-shadow:0 8px 20px rgba(0,0,0,0.4);
    max-width:550px;
    width:95%;
    margin:10px;
    animation:fadeIn 0.5s ease-in;
  }
  h2,h3{margin-top:0;color:#ffdd57;text-shadow:1px 1px 4px #000;}
  input,button,select{
    width:90%;padding:12px;margin:8px 0;border-radius:8px;border:none;font-size:1rem;outline:none;
  }
  input{background:#f4f4f4;}
  button{
    background: linear-gradient(135deg,#ff6a00,#ee0979);
    color:white;font-weight:bold;cursor:pointer;transition:transform 0.2s,opacity 0.3s;
  }
  button:hover{transform:scale(1.05);opacity:0.9;}
  .hidden{display:none;}
  #inventory{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto;}
  #inventory li{
    background: rgba(255,255,255,0.1);
    margin:5px 0;
    padding:8px;
    border-radius:6px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .delete-btn{
    background: crimson;color:white;border:none;border-radius:6px;padding:3px 8px;cursor:pointer;font-size:0.8rem;
  }
  #wheelBox{
    margin:20px auto;
    width:250px;
    height:60px;
    overflow:hidden;
    border:3px solid #fff;
    border-radius:8px;
    background: rgba(0,0,0,0.8);
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .prizeText{
    font-size:1.4rem;font-weight:bold;transition:transform 0.1s;
  }
  .theme-dog{background:url('https://i.imgur.com/9i5G79G.jpg') center/cover;}
  .theme-pirate{background:url('https://i.imgur.com/m5mG93q.jpeg') center/cover;}
  .theme-neon{background:linear-gradient(135deg,#0f0f0f,#00ffcc);}
  .theme-spooky{background:url('https://i.imgur.com/jyCOb3u.jpg') center/cover;}
  @keyframes fadeIn{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
  }
</style>
</head>
<body>
<div class="card" id="loginCard">
<h2>Questwork Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Sign In</button>
</div>

<div class="card hidden" id="gameBox">
<h2>Welcome, <span id="playerName"></span>!</h2>
<p>‚≠ê Points: <span id="points">0</span></p>

<div id="wheelButtons">
<button onclick="spin()">Spin Wheel</button>
</div>

<div id="wheelBox"><div class="prizeText" id="prizeDisplay">?</div></div>
<p id="result"></p>

<h3>Inventory</h3>
<ul id="inventory"></ul>

<h3>Theme Selector</h3>
<select id="themeSelect" onchange="applyTheme(this.value)">
<option value="">--Choose Theme--</option>
</select>

<h3>Teacher Controls</h3>
<input type="password" id="teacherCode" placeholder="Enter teacher code">
<input type="number" id="pointsToAdd" placeholder="Points to add">
<button onclick="addPoints()">Add Points</button>
</div>

<script>
const TEACHER_SECRET="QUEST123";

// Single universal wheel with weights
const wheelPrizes=[
  {name:"Sticker Pack",weight:4,refund:2},
  {name:"Dog Theme",weight:2,type:"theme"},
  {name:"Pencil Upgrade",weight:3},
  {name:"Pirate Theme",weight:1,type:"theme"},
  {name:"Neon Theme",weight:1,type:"theme"},
  {name:"Spooky Theme",weight:1,type:"theme"},
  {name:"1 Bonus Point",weight:2,type:"points",amount:1},
  {name:"50 Bonus Points",weight:1,type:"points",amount:50}
];

let accounts=JSON.parse(localStorage.getItem("accounts"))||{};
let currentUser=null;
function saveData(){localStorage.setItem("accounts",JSON.stringify(accounts));}

function signup(){
  let u=document.getElementById("username").value;
  let p=document.getElementById("password").value;
  if(!u||!p)return alert("Enter username and password.");
  if(accounts[u])return alert("Account exists!");
  accounts[u]={password:p,points:0,inventory:[],themes:[],selectedTheme:""};
  saveData();currentUser=u;startGame();
}

function login(){
  let u=document.getElementById("username").value;
  let p=document.getElementById("password").value;
  if(!accounts[u])return alert("No account. Sign up first.");
  if(accounts[u].password!==p)return alert("Wrong password.");
  currentUser=u;startGame();
}

function startGame(){
  document.getElementById("playerName").innerText=currentUser;
  updateUI();
  document.getElementById("loginCard").classList.add("hidden");
  document.getElementById("gameBox").classList.remove("hidden");
}

function weightedRandom(items){
  let total=items.reduce((sum,i)=>sum+i.weight,0);
  let r=Math.random()*total;
  for(let i of items){if(r<i.weight)return i;r-=i.weight;}
}

function spin(){
  let acc=accounts[currentUser];
  if(acc.points<5)return alert("Not enough points!");
  acc.points-=5;

  let prize=weightedRandom(wheelPrizes);
  let prizeDisplay=document.getElementById("prizeDisplay");
  let result=document.getElementById("result");

  let flips=30,step=0,interval=50;
  let bounce=0;
  let anim=setInterval(()=>{
    step++;
    let fake=wheelPrizes[Math.floor(Math.random()*wheelPrizes.length)].name;
    prizeDisplay.innerText=fake;
    prizeDisplay.style.transform=`translateY(${bounce}px)`;
    bounce=Math.sin(step/2)*8;
    if(step>=flips){
      clearInterval(anim);
      prizeDisplay.innerText=prize.name;
      prizeDisplay.style.transform="translateY(0)";
      // duplicates
      let already=acc.inventory.includes(prize.name)||acc.themes.includes(prize.name.split(" ")[0].toLowerCase());
      if(already&&prize.type!=="points"){
        acc.points+=prize.refund||5;
        result.innerText=`Duplicate! Refunded ${prize.refund||5} pts.`;
      } else{
        if(prize.type==="points")acc.points+=prize.amount;
        else if(prize.type==="theme")acc.themes.push(prize.name.split(" ")[0].toLowerCase());
        else acc.inventory.push(prize.name);
        result.innerText=`üéâ You won: ${prize.name}`;
      }
      updateUI();
    }
    interval+=10; // gradually slow down
  },interval);
}

function updateUI(){
  let acc=accounts[currentUser];
  document.getElementById("points").innerText=acc.points;
  let inv=document.getElementById("inventory");
  inv.innerHTML="";
  acc.inventory.forEach((item,idx)=>{
    let li=document.createElement("li");li.innerText=item;
    let del=document.createElement("button");del.innerText="x";del.className="delete-btn";
    del.onclick=()=>{acc.inventory.splice(idx,1);updateUI();}
    li.appendChild(del);inv.appendChild(li);
  });
  let themeSelect=document.getElementById("themeSelect");
  themeSelect.innerHTML="<option value=''>--Choose Theme--</option>";
  acc.themes.forEach(t=>{
    let opt=document.createElement("option");opt.value=t;opt.innerText=t[0].toUpperCase()+t.slice(1)+" Theme";
    if(t===acc.selectedTheme)opt.selected=true;
    themeSelect.appendChild(opt);
  });
  if(acc.selectedTheme)applyTheme(acc.selectedTheme);
  saveData();
}

function applyTheme(theme){
  let acc=accounts[currentUser];
  acc.selectedTheme=theme;
  document.body.className="";
  if(theme)document.body.classList.add("theme-"+theme);
  saveData();
}

function addPoints(){
  let code=document.getElementById("teacherCode").value;
  let amt=parseInt(document.getElementById("pointsToAdd").value);
  if(code===TEACHER_SECRET&&amt>0){accounts[currentUser].points+=amt;updateUI();alert("Added "+amt+" points!");}
  else alert("Wrong teacher code!");
}
</script>
</body>
</html>
